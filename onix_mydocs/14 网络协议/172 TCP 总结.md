# TCP 总结

- [x] MUST-1：窗口大小 **必须** 作为无符号数，**建议** 采用 32 位来记录和计算窗口；

- [x] MUST-2：发送方 **必须** 生成校验和；

- [x] MUST-3：接收方 **必须** 检查校验和；

- [x] MUST-4：**必须** 支持如下选项：

    | 类型 | 名称 | 长度 | 描述         |
    | ---- | ---- | ---- | ------------ |
    | 0    | EOL  | -    | 选项结束     |
    | 1    | NOP  | -    | 无操作       |
    | 2    | MSS  | 4    | 最大分段尺寸 |

- [x] MUST-5：**必须** 在任何段中都支持接收 TCP 选项；

- [x] MUST-6：**必须** 忽略任何它没有实现的 TCP 选项而不会出错；

- [x] MUST-7：**必须** 准备好处理不合法的选项长度，比如 0，**建议** 的做法是重置连接并记录日志；

- [ ] MUST-8：**必须** 使用 **时钟** 来进行时钟驱动的初始序列号选择，**应该** 以如下表达式生成初始序列号；

    ISN = M + F(localip, localport, remoteip, remoteport, secretkey)

- [ ] MUST-9：`F()` **必须不** 能由外部计算，或者说不能被攻击者猜到；

- [ ] MUST-10：**必须** 支持双方同时主动（作为客户端）连接；

- [ ] MUST-11：必须跟踪连接是否已达到 `SYN-RECEIVED` 状态作为被动打开或主动打开的结果；

- [x] MUST-12：本地应用 **必须** 在正常终止 (close) 或异常终止 (abort) 被通知；

- [x] MUST-13：**必须** 在 `TIME-WAIT` 状态等待 `2 * MSL(Maximum Segment Lifetime)` 的时间；`TIME-WAIT` 状态可以重新接受 `SYN` 以重新打开连接；

- [x] MUST-14：**必须** 实现 MSS 选项；

- [x] MUST-15：**必须** 假设默认 MSS，IPv4 为 (576 - 40)，IPv6 为 (1280 - 60)；

- [x] MUST-16：有效 MSS **必须** 小于等于接收方的 MSS(可能因为 TCP 选项挤占了一部分)；

- [x] MUST-17：**必须** 有一种方法可以让应用为单独的连接禁用 Nagle 算法；

- [x] MUST-18：RTO(Retransmission TimeOut) 重传超时 **必须** 由算法 [^rfc6298] 计算；

- [x] MUST-19：**必须** 基础的拥塞控制算法：

    - [x] 慢启动
    - [x] 拥塞避免
    - [x] 指数退避
    </br></br>

- [ ] MUST-20：
    
    - [ ] 当 重传同一个段达到 `R1` 时，向 IP 层，传递负面建议；
    - [ ] 当 `R2 > R1` 时，关闭连接；
    </br></br>

- [ ] MUST-21：应用程序 **必须** 可以为每个连接设置 `R2`

- [ ] MUST-22：`SYN` 采用同样的机制；?

- [ ] MUST-23：`SYN` 段的 `R2` 必须设置得足够大，以提供至少 3 分钟的重传时间；

- [x] MUST-24：应用程序 **必须** 可以为每个连接打开或关闭保活 (Keep-Alive) 机制；

- [x] MUST-25：保活机制 **必须** 默认关闭；

- [x] MUST-26：保活包 **必须** 只在没有未处理的发送数据，并且在 **一段时间** 内没有收到数据或确认包时才发送；

- [ ] MUST-27：MUST-26 中的 一段时间 **必须** 可以配置；

- [x] MUST-28：MUST-26 中的 一段时间 默认不少于 2 小时；

- [x] MUST-29：保活机制 **绝不能** 将对任何特定探测的响应失败解释为连接已死；

- [ ] MUST-30：**必须** 支持紧急机制；但新应用 **不应该** 采用紧急机制；

- [ ] MUST-31：**必须** 支持任意长度的紧急数据；

- [ ] MUST-32：**必须** 实现异步通知应用层，无论何时，接收到一个紧急指针，并且以前没有待处理的紧急数据，或者无论何时紧急指针在数据流中前进；

- [ ] MUST-33：**必须** 为应用程序提供一种方法来了解还有多少紧急数据需要从连接中读取，或者至少确定是否还有更多紧急数据需要读取；

- [x] MUST-34：窗口 **不应该** 缩减，但 **必须** 健壮地应对对方窗口缩减，这可能使窗口变成负值；

- [x] MUST-35：当窗口缩减为 0 时，**必须** 以标准方法来检测窗口；

- [x] MUST-36：**必须** 支持零窗口探测；

- [x] MUST-37：发送方 **必须** 允许连接保持打开；

- [x] MUST-38：发送方 **必须** 有 SWS(Silly Window Syndrome) 避免算法；

- [x] MUST-39：接受方 **必须** 有 SWS(Silly Window Syndrome) 避免算法；

- [x] MUST-40：延迟 ACK **必须** 小于 0.5 秒；

- [x] MUST-41：每个被动 `OPEN` 调用要么在 `LISTEN` 状态下创建一个新的连接记录，要么返回一个错误，它绝对不能影响任何先前创建的连接记录；

- [ ] MUST-42：支持多个并发连接的 TCP 实现 **必须** 提供一个 `OPEN` 调用，该调用将在功能上允许应用程序在端口上监听，而具有相同本地端口的连接协议控制块处于 `SYN-SENT` 或 `SYN-RECEIVED` 状态；

- [x] MUST-43：**必须** 支持可选的 本地 IP 地址 参数，以允许指定本地 IP 地址；

- [x] MUST-44：**必须** 在发送(第一个) `SYN` 之前要求 IP 层选择一个本地 IP 地址；

- [x] MUST-45：**必须** 使用与已发送的段相同的本地地址；

- [x] MUST-46：**必须** 拒绝无效的远程 IP 地址调用 `OPEN` (广播地址或多播地址)；

- [x] MUST-47：**必须** 有一个向应用程序报告软 TCP 错误条件的机制；

- [x] MUST-55：**必须** 悄悄地丢弃任何收到的 ICMP 源 QUENCH 消息；

- [ ] MUST-56：由于 ICMP 不可达消息表示的软错误条件，**绝不能** 中止连接，并且 **应该** 使应用程序可以获得这些信息；

- [x] MUST-57：**必须** 悄悄地丢弃一个以 广播 或 多播 地址为地址的传入 SYN 报文段；

- [x] MUST-58：处理接收到的报文段时，**必须** 在可能的情况下实现 ACK 报文段的合并；

- [x] MUST-59：**必须** 在发送任何 `ACK` 之前处理已收到的报文段；

- [x] MUST-60：**绝不能** 无限缓冲数据；

- [x] MUST-61：`SEND` 调用的最后一个分段必须设置 `PSH` 标志；

- [ ] MUST-62：紧急指针 **必须** 指向在紧急数据后字节的序列号；

- [ ] MUST-63：无效源地址的传入 `SYN` 必须被 TCP 或 IP 层忽略；

- [x] MUST-64：接收方 **必须** 处理没有对齐机器字的选项；

- [x] MUST-65：除建立连接以外的数据包，**必须** 没有 MSS 选项；

- [ ] MUST-66：接收方 **必须** 处理 `RST` 和 `URG` 字段，即便接收窗口为 0；

- [x] MUST-67：`MSS` 选项的值必须小于等于 `MSS_R - 20`；其中 `MSS_R` 是 TCP 包的最大长度，20 是 TCP 包头的最小长度；

- [x] MUST-68：除 EOL 和 NOP 选项外，所有的选项 **必须** 有 长度(length) 字段，包括所有未来的选项；

- [x] MUST-69：TCP 选项列表结尾 **必须** 用 0 填充到四字节对齐；

## HTTP 服务器

HTTP 协议定义在 RFC2616 [^rfc2616]；

# 参考

[^rfc6298]: <https://datatracker.ietf.org/doc/html/rfc6298>
[^rfc2616]: <https://datatracker.ietf.org/doc/html/rfc2616>
