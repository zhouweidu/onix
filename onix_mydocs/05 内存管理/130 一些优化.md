# 一些优化

## 更新初始化的方式

将需要中断功能的设备初始化放到 init 进程中，此使系统已经支持中断功能。一些设备初始化时必须要中断（比如软盘），使得后续功能尽可能一致。

## 内核扩容

将内核大小上线从 100K 调整到 127K，便于添加新功能，动机来自后期改动时产生的错误，意味着内核的大小将会超过 100K。

## 页表拷贝机制

实现页表和页目录的写时拷贝，提高内存的利用率。

由于之前没有找到更好的解决办法，原先的机制是 `fork` 时直接拷贝页表，这不会出问题，但是如果子进程和父进程之间的部分页表自始至终都没有发生变化的话，将会浪费很多内存。于是找到了这里的解决办法。

那就是将页表也实现写时复制，这样一方面会节约内存，另一方面会提升 fork 的效率。

## 输入输出双字

支持 32位 的输入和输出。

```c++
extern u32 inl(u16 port); // 输入一个双字
extern void outl(u16 port, u32 value); // 输出一个双字
```
